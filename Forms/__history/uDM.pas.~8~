unit uDM;

interface

uses
  System.SysUtils, System.Classes, Data.DB, Data.SqlExpr, Data.DBXFirebird,IniFiles,
  Windows,Menus,Controls,Forms, Data.FMTBcd, Datasnap.DBClient,
  Datasnap.Provider;

type
  TDM = class(TDataModule)
    Conexao: TSQLConnection;
    qUsuario: TSQLQuery;
    qUsuarioID_USUARIO: TIntegerField;
    qUsuarioSENHA: TStringField;
    qUsuarioNIVEL: TSmallintField;
    dspUsuario: TDataSetProvider;
    cdsUsuario: TClientDataSet;
    cdsUsuarioID_USUARIO: TIntegerField;
    cdsUsuarioSENHA: TStringField;
    cdsUsuarioNIVEL: TSmallintField;
    dsUsuario: TDataSource;
    qDinamica: TSQLQuery;
    dspDinamica: TDataSetProvider;
    cdsDinamica: TClientDataSet;
    dsDinamica: TDataSource;
    DataSource2: TDataSource;
    ClientDataSet2: TClientDataSet;
    DataSetProvider2: TDataSetProvider;
    SQLQuery2: TSQLQuery;
    sds_Tabela: TSQLDataSet;
    dsp_Tabela: TDataSetProvider;
    cds_Tabela: TClientDataSet;
    ds_Tabela: TDataSource;
    qUsuarioLOGIN: TStringField;
    cdsUsuarioLOGIN: TStringField;
    procedure DataModuleCreate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
    IniControle : TIniFile;
    CAIXA,LOJA,IMPRESSORA,LOGO,EXPORTA,CONFIGURADO,TABELA_PRECO, VENDEDOR,BALANCA : string;

  end;

var
  DM: TDM;

implementation

{%CLASSGROUP 'Vcl.Controls.TControl'}

{$R *.dfm}

procedure TDM.DataModuleCreate(Sender: TObject);
begin
  if Conexao.Connected = True then
     Conexao.Connected := False;
  if (not Conexao.Connected ) then
  begin
    try
      IniControle := TIniFile.Create(ExtractFilePath(Application.ExeName)+'CONFIG.INI');
      if Trim(IniControle.ReadString('SERVIDOR', 'DADOS', '')) <> '' then
      begin
        Conexao.Params.Clear;
        Conexao.Params.Values['DATABASE'] := Inicontrole.ReadString('SERVIDOR','DADOS','');
        Conexao.Params.Values['User_Name'] := Inicontrole.ReadString('SERVIDOR','User_Name','');
        Conexao.Params.Values['PASSWORD'] := Inicontrole.ReadString('SERVIDOR','PASSWORD','masterkey');
        Conexao.Params.Values['SQLDialect'] := Trim(Inicontrole.ReadString('SERVIDOR','SQLDialect','3'));
        Conexao.connected:= true;
        Inicontrole.Free;
      end;
    except
      Application.MessageBox( 'Não foi possivel conectar com o banco de dados.' + #13 +
                              'verifique se o arquivo de configuração está configurado, ' + #13 +
                              'Tente Novamente ou Entre em contato com suporte para esclarecer qualquer dúvida.',
                              'Error Interno',mb_ok + mb_IconError );
        Application.Terminate;
    end;
  end;

end;

end.
